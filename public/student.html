<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Student - Realtime Classroom</title>
<style>
  body { text-align: center; font-family: Arial, sans-serif; }
  video { width: 90%; max-width: 1000px; border: 2px solid black; margin-top: 20px; background-color: black; }
  button { margin: 10px; padding: 10px; }
</style>
</head>
<body>
<h1>Student View</h1>
<video id="studentVideo" autoplay playsinline></video>
<button id="requestMic">🎤 Request Mic</button>

<script src="https://cdn.socket.io/4.8.1/socket.io.min.js"></script>
<script>
const socket = io();
const studentVideo = document.getElementById("studentVideo");
const requestMicBtn = document.getElementById("requestMic");
const pc = new RTCPeerConnection();

pc.ontrack = event => {
    studentVideo.srcObject = event.streams[0]; // هذا يحوّل البث الوارد للفيديو
};


pc.onicecandidate = event => {
  if(event.candidate){
    socket.emit("signal", { to: "teacher", signal: { candidate: event.candidate } });
  }
};

// الانضمام للصف
socket.emit("join-room", "student");

// استقبال إشارة من المعلم
socket.on("signal", async data => {
  if(data.signal.sdp){
    await pc.setRemoteDescription(new RTCSessionDescription(data.signal.sdp));
    const answer = await pc.createAnswer();
    await pc.setLocalDescription(answer);
    socket.emit("signal", { to: data.from, signal: { sdp: answer } });
  }
  if(data.signal.candidate){
    await pc.addIceCandidate(new RTCIceCandidate(data.signal.candidate));
  }
});

// طلب المايك
requestMicBtn.onclick = () => {
  socket.emit("request-mic");
};

// المعلم يفعل المايك
socket.on("mic-enabled", async () => {
  const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
  stream.getAudioTracks().forEach(track => pc.addTrack(track, stream));
  alert("الميكروفون مفعل الآن!");
});
</script>
</body>
</html>




